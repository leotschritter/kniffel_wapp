@import play.api.libs.json._
@(controller: de.htwg.se.kniffel.controller.controllerBaseImpl.Controller, dice: Boolean = false)
@matrix = @{
    controller.field.getRows
}
@firstColumn = @{
    List("assets/images/3_mal_1.png", "assets/images/3_mal_2.png", "assets/images/3_mal_3.png",
        "assets/images/3_mal_4.png", "assets/images/3_mal_5.png", "assets/images/3_mal_6.png", "gesamt", "Bonus ab 63",
        "gesamt oberer Teil", "Dreierpasch", "Viererpasch", "Full-House", "Kleine Straße", "Große Straße", "Kniffel", "Chance",
        "gesamt unterer Teil", "gesamt oberer Teil", "Endsumme")
}
@firstColumnPopover = @{
    List("assets/images/1.png", "assets/images/2.png", "assets/images/3.png",
        "assets/images/4.png", "assets/images/5.png", "assets/images/6.png", "", "",
        "", "Dreierpasch", "Viererpasch", "Full-House", "Kleine Straße", "Große Straße", "Kniffel", "Chance",
        "", "", "")
}
@secondColumn = @{
    List("nur Einser zählen", "nur Zweier zählen", "nur Dreier zählen", "nur Vierer zählen",
        "nur Fünfer zählen", "nur Sechser zählen", "assets/images/right_arrow.png", "plus 35", "assets/images/right_arrow.png",
        "alle Augen zählen", "alle Augen zählen", "25 Punkte", "30 Punkte", "40 Punkte", "50 Punkte", "alle Augen zählen",
        "assets/images/right_arrow.png", "assets/images/right_arrow.png", "assets/images/right_arrow.png")
}
@configJson = @{
    Json.obj("trigger" -> "hover")
}
@main("HTWG Kniffel") {

    <link rel="stylesheet" href="assets/stylesheets/kniffel.css">
    <div class="d-flex justify-content-center">
        <div style="@(if(!(controller.getDicecup.isRunning || controller.getGame.isRunning)) {
            "display: none"
        } else {
            ""
        })" class="board">
            <div class="diceBoard">
                <div class="cup" style="@(if(dice) {
                    ""
                } else {
                    "background: none; animation: none;"
                })">
                    <div class="diceInCup">
                    @for(i <- 0 until controller.diceCup.getInCup.length) {
                        <div style="@(if(dice) {
                            ""
                        } else {
                            "visibility: visible"
                        })" onclick="putOut(@{controller.diceCup.getInCup(i)})" class="dice d@{
                            i + 1
                        } dice_@{
                            controller.diceCup.getInCup(i)
                        } inCup"></div>
                    }
                    </div>
                </div>
            </div>
            <div class="actionBox">
                <img style="@(if(controller.getDicecup.getRemainingDices < 2) {
                    " opacity: 0.3"
                } else {
                    ""
                })"
                src="assets/images/dicecup_small.png" />
                <img style="@(if(controller.getDicecup.getRemainingDices < 1) {
                    " opacity: 0.3"
                } else {
                    ""
                })"
                src="assets/images/dicecup_small.png" />
                <img style="@(if(controller.getDicecup.getRemainingDices < 0) {
                    " opacity: 0.3"
                } else {
                    ""
                })"
                src="assets/images/dicecup_small.png" />
                <button type="button" style="margin-top: 5px" onclick="putIn('@{controller.diceCup.getLocked.mkString(",")}')" class="btn btn-dark" ><span class="material-symbols-outlined">
                    keyboard_double_arrow_left</span></button>
                <button style="margin-top: 5px;" @(if(controller.getDicecup.getRemainingDices < 0) {
                    "disabled"
                } else {
                    ""
                }) onclick="window.location.href = 'dice'" id="diceButton" type="button" class="btn btn-dark">
                    <img style="margin-top: -5px;" width="40px" src="assets/images/flying_dices_small_white.png" /></button>
            </div>
            <div class="diceStorage">
            @for(i <- 0 until controller.diceCup.getLocked.length) {
                <div onclick="putIn(@{controller.diceCup.getLocked(i)})" class="dice d@{
                    controller.diceCup.getInCup.length + i + 1
                } dice_@{
                    controller.diceCup.getLocked(i)
                } storage"></div>
            }
            </div>
        </div>
    </div>
    <script src="@routes.Assets.versioned("javascripts/kniffel.js")" type="text/javascript"></script>

    <div style="@(if(!(controller.getDicecup.isRunning || controller.getGame.isRunning)) {
        "display: none"
    } else {
        ""
    })"
    class="gamecontainer">
        <div class="game">
            @* <button type="button" class="btn btn-secondary" data-toggle="popover" data-placement="bottom" data-trigger="hover" title="Available Options"
            data-template="@Html(s"""<div class='popover' role='tooltip'><div class='arrow'></div><h3 class='popover-header'></h3><div class='popover-body'></div></div>""")">
            Show Options
            </button>*@
            <div class="table-container">
                <table>
                    <thead>
                        <tr class="main-heading">
                            <th><button onclick="document.getElementsByClassName('table-container')[0].scrollIntoView();" type="button" id="scrollDown"
                            class="btn btn-block"><span class="material-symbols-outlined">
                                expand_content</span></button></th>
                            <th>@*<button type="button" class="btn btn-secondary" data-bs-container="body" data-bs-toggle="popover"
                                data-bs-title="Available Options" data-bs-placement="bottom" data-bs-content=" " data-bs-trigger="hover">
                                Available Options
                                </button>*@</th>
                            @for(col <- 0 until matrix(0).length) {
                                <th>@{
                                    controller.game.getPlayerName(col)
                                }</th>
                            }
                        </tr>
                    </thead>
                    @for(row <- 0 until matrix.length) {
                        @for(col <- 0 until matrix(0).length) {
                            @if(col == 0) {
                                <tr>
                                    @if(row < 6) {
                                        <td>
                                            <button @(if(controller.getField.getMatrix.isEmpty(controller.getGame.getPlayerID,
                                                row)) {
                                                ""
                                            } else {
                                                "disabled"
                                            }) onclick="window.location.href = 'write?to=@{row+1}'"
                                            class="btnAction"><img src=@{
                                                firstColumn(row)
                                            } /></button>
                                        </td>
                                    } else if(row > 8 && row < 16) { <td>
                                    <button @(if(controller.getField.getMatrix.isEmpty(controller.getGame.getPlayerID,
                                        row)) {
                                        ""
                                    } else {
                                        "disabled"
                                    })
                                    onclick="window.location.href = 'write?to=@{controller.getField.getFirstColumn(row).toUpperCase()}'"
                                    class="btnAction">@{
                                        firstColumn(row)
                                    }</button>
                                </td>
                                    } else {
                                    <td>@{
                                        firstColumn(row)
                                    }</td>
                                    }
                                    @if(row == 6 || row == 8 || row > 15) {
                                        <td class="secondColumn"><span class="material-symbols-outlined">
                                            arrow_right_alt</span></td>
                                    } else {
                                        <td class="secondColumn">@{
                                            secondColumn(row)
                                        }</td>
                                    }
                                }
                            <td class=@if(col == controller.getGame.getPlayerID) {"activeCol"
                        } else
                            {""}
                            >
                            <span class="cell">@{
                                matrix(row)(col)
                            }</span>
                            </td>
                            @if(col == matrix(0).length - 1) {
                            </tr>
                            }
                        }

                    }
                </table>
            </div>
            <script>
                    $(document).ready(function () {
                        if (@{!controller.getGame.isRunning}) {
                            document.getElementById('actionSave').classList.add('disabled');
                            document.getElementById('actionUndo').classList.add('disabled');
                            document.getElementById('actionRedo').classList.add('disabled');
                            document.getElementById('actionGame').classList.add('disabled');
                        }
                    });

            </script>
            @*<script>
            $(document).ready(function() {
            $('[data-bs-toggle="popover"]').popover();

            $('[data-bs-toggle="popover"]').on('shown.bs.popover', function() {
            const element = document.getElementsByClassName('popover-body')[0];
            const table = document.createElement("table");
            @for(row <- 0 until matrix.length) {
            @if(!((row > 5 && row < 9) || (row > 15))) {
            if (@{controller.getField.getMatrix.isEmpty(controller.getGame.getPlayerID, row)}) {
            let tableElement;
            @if(row == 9) {
            const newRow = document.createElement("tr");
            table.appendChild(newRow);
            }
            @if(row < 9) {
            const imgElement = document.createElement("img");
            imgElement.src = "@{firstColumnPopover(row)}";
            tableElement = document.createElement("td");
            tableElement.appendChild(imgElement);
            } else {
            tableElement = document.createElement("td");
            tableElement.innerHTML = "@{firstColumnPopover(row)}"
            }
            table.appendChild(tableElement);
            // tableElement.value = "xyz";
            }
            }
            }
            element.appendChild(table);
            /!*console.log(element);
            console.log("@{controller.game.getPlayerID}")
            console.log("@{controller.field.getFirstColumn}");*!/
            // Your custom code for when the popover is fully shown
            });
            });
            </script>*@
        </div>
    </div>
}